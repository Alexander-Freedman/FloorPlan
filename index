<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Photopea PDF & Image Text/8×8 Remover</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      background: #f5f5f5;
      margin: 0;
    }
    h1 {
      margin-bottom: 1rem;
    }
    #controls {
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    #openBtn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background: #2d8cff;
      color: white;
      cursor: pointer;
      font-size: 1rem;
    }
    #openBtn:disabled {
      background: #aacfff;
      cursor: default;
    }
    iframe {
      width: 100%;
      height: 80vh;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <h1>Upload PDF or Image → Remove Text & 8×8 Paths</h1>

  <div id="controls">
    <!-- Now includes .pdf -->
    <input type="file" id="fileInput" accept=".pdf,.psd,.png,.jpg,.jpeg" />
    <button id="openBtn" disabled>Open in Photopea</button>
  </div>

  <iframe id="photopeaFrame" src="" allow="clipboard-read; clipboard-write"></iframe>

  <script>
    const fileInput = document.getElementById('fileInput');
    const openBtn   = document.getElementById('openBtn');
    const iframe    = document.getElementById('photopeaFrame');

    // Your Photopea script to delete text layers and 8×8 paths:
    const photopeaScript = `
function deleteTextLayers(layers) {
    for (var i = layers.length - 1; i >= 0; i--) {
        var layer = layers[i];
        if (layer.typename == "ArtLayer") {
            var bounds = layer.bounds;
            var height = Math.round(bounds[3] - bounds[1]);
            var width  = Math.round(bounds[2] - bounds[0]);
            if (layer.kind == LayerKind.TEXT || (height == 8 && width == 8)) {
                layer.remove();
            }
        } else if (layer.typename == "LayerSet") {
            deleteTextLayers(layer.layers);
        }
    }
}
(function() {
    var doc = app.activeDocument;
    deleteTextLayers(doc.layers);
})();
`.trim();

    // Enable the button once a file is selected
    fileInput.addEventListener('change', () => {
      openBtn.disabled = !fileInput.files.length;
    });

    openBtn.addEventListener('click', () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        // Build Photopea config
        const config = {
          files: [ reader.result ],
          script: photopeaScript
        };
        const url  = 'https://www.photopea.com#' + encodeURIComponent(JSON.stringify(config));
        iframe.src = url;
      };
      reader.readAsDataURL(file);
    });
  </script>

</body>
</html>
